name: Auto-Format DB2 SQL Files

on:
  push:
  pull_request:

jobs:
  format-sql:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ›Ž Checkout repository
        uses: actions/checkout@v3

      - name: ðŸ›  Install sqlfluff
        run: pip install sqlfluff

      - name: ðŸ”„ Format all SQL files
        run: |
          find . -name "*.sql" | while read file; do
            echo "âš¡ Formatting $file..."
            sqlfluff fix --dialect db2 "$file" --force
          done

      - name: ðŸš€ Commit formatted SQL files
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git add *.sql
          git commit -m "ðŸ”„ Auto-formatted SQL files" || echo "No changes to commit"
          git push